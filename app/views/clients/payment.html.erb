
<script type="text/javascript"  src="https://api.chargeio.com/assets/api/v1/chargeio.min.js"></script>

<h2 class="fancy-title">Payment Stage</h2>
<form>
  <div class="container">

    <!-- BILLING INFORMATION -->
    <div class="row">

          <h3>Billing Details</h3>

          <div class="form-group margin-sm">
            <label>Name on Card</label>
            <input type="text" name="name" placeholder="Name on card" class="form-control">
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="text" name="email" placeholder="Email" class="form-control">
          </div>

          <div class="form-group">
            <label>Billing Address</label>
            <input type="text" name="billingAddress1" placeholder="Billing Address" class="form-control">
          </div>

          <div class="form-group">
            <input type="text" name="billingAddress2" placeholder="Billing Address 2" class="form-control">
          </div>

          <div class="form-group">
            <input type="text" name="billingCity" placeholder="City" class="form-control">
          </div>

          <div class="form-group">
            <%= select_tag "billingState", options_for_select(us_states), { class:"form-control"} %>
          </div>

          <div class="form-group">
            <input type="text" name="billingZip" placeholder="Zip / Postal Code" class="form-control">
          </div>

      </div>
      <!-- BILLING INFORMATION -->
      <!-- CC INFORMATION -->
      <div class="row margin-md">
          <div class="col-xs-12 col-md-offset-4 col-md-4">
              <div class="panel panel-default credit-card-box">
                  <div class="panel-heading display-table">
                      <div class="row display-tr" >
                          <h3 class="panel-title display-td" >Payment Details</h3>
                          <div class="display-td" >
                              <img class="img-responsive pull-right" src="http://i76.imgup.net/accepted_c22e0.png">
                          </div>
                      </div>
                  </div>
                  <div class="panel-body">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="form-group">
                                <label for="number">Card Number</label>
                                <div class="input-group">
                                  <input
                                      type="tel"
                                      class="form-control"
                                      name="number"
                                      placeholder="Valid Card Number"
                                      autocomplete="cc-number"
                                      required
                                      />
                                      <span class="input-group-addon"><i class="fa fa-credit-card"></i></span>
                                    </div>
                                  </div>
                                </div>
                            </div>
                                <div class="row">
                                  <div class="col-xs-12 col-md-6">
                                    <div class="form-group">
                                      <label for="exp_month"><span class="hidden-xs">Expiration</span><span class="visible-xs-inline">Exp</span> Month</label>
                                      <input
                                      type="tel"
                                      class="form-control"
                                      name="exp_month"
                                      placeholder="MM"
                                      autocomplete="cc-exp"
                                      required
                                      />
                                    </div>
                                  </div>
                                  <div class="col-xs-12 col-md-6">
                                    <div class="form-group">
                                      <label for="exp_year"><span class="hidden-xs">Expiration</span><span class="visible-xs-inline">Exp</span> Year</label>
                                      <input
                                      type="tel"
                                      class="form-control"
                                      name="exp_year"
                                      placeholder="YYYY"
                                      autocomplete="cc-exp"
                                      required
                                      />
                                    </div>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-xs-12">
                                    <div class="form-group">
                                      <label for="cvv">CVV</label>
                                      <input
                                        type="tel"
                                        class="form-control"
                                        name="cvv"
                                        placeholder="CVC"
                                        autocomplete="cc-csc"
                                        required
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col-xs-12">
                                      <button type="submit" id="pay" class="button btn-block">Process Payment</button>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col-xs-12">
                                      <div id="messages" class="alert alert-danger margin-sm" hidden="true">
                                        <p>The following errors prevented the transaction from going through:</p>
                                        <br>
                                        <ul id="payment_error_ul"></ul>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                  </div>
              </div>
          </div>
          <!-- CC INFORMATION -->
        </div>
      </div>
  </form>

  <script>

    $(document).ready(function() {

      ChargeIO.init({ public_key: 'm_17BURrtKStm9PEzYWU7YSg' });

       ChargeIO.ready(function() {

         $('#pay').click(function(event) {
           event.preventDefault();
           var amount = parseInt($('#total').text().replace(/\D/g,''));
           var paymentJson = ChargeIO.payment_params($('form'));
           ChargeIO.create_token(paymentJson, function(token) {
             $.post('http://localhost:3000/payment/pay', { 'amount': amount, 'token_id': token.id }).done(function(data) {
               if (data.messages) {
               }
               else {
               }
             }).fail(function(xhr) {
             });
           });
         });
       });

    });

  </script>
